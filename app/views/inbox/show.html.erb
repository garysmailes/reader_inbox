<div class="inbox">
  <div class="inbox__card">
    <div class="inbox__header">
      <h1 class="inbox__title">Reading Inbox</h1>
      <a class="inbox__nav_link" href="<%= archive_path %>">Archive</a>
    </div>

    <p class="inbox__hint">Paste a link now. Read it later.</p>

    <% if flash[:alert].present? %>
      <div class="inbox__alert"><%= flash[:alert] %></div>
    <% end %>

    <% if flash[:notice].present? %>
      <div class="inbox__notice"><%= flash[:notice] %></div>
    <% end %>

    <%= form_with url: saved_items_path, scope: :saved_item, class: "inbox__form" do |form| %>
      <%= form.url_field :url,
        required: true,
        autofocus: true,
        placeholder: "https://example.com/article",
        class: "inbox__input" %>

      <%= form.submit "Save", class: "inbox__button" %>
    <% end %>

    <% if @saved_items.present? %>
      <ul class="inbox__list" aria-label="Saved items">
        <% @saved_items.each do |item| %>
          <li class="inbox__item">
            <p class="inbox__item_title">
              <a class="inbox__item_link"
                 href="<%= open_saved_item_path(item) %>"
                 target="_blank"
                 rel="noopener noreferrer">
                <%= item.fetched_title.presence || clean_url_for(item) %>
              </a>
            </p>

            <div class="inbox__item_meta">
              <span class="inbox__item_state inbox__item_state--<%= item.state %>">
                <%= item.state.capitalize %>
              </span>

              <% if item.domain.present? %>
                <span class="inbox__item_domain"><%= item.domain %></span>
              <% elsif item.fetched_title.present? %>
                <span class="inbox__item_domain"><%= clean_url_for(item) %></span>
              <% end %>

              <% if metadata_unavailable?(item) %>
                <span class="inbox__item_note">Metadata was not available</span>
              <% end %>

              <div class="inbox__item_actions">
                <% unless item.read? %>
                  <%= button_to "Set read",
                    state_saved_item_path(item),
                    method: :patch,
                    params: { saved_item: { state: "read" } },
                    class: "inbox__item_action",
                    form_class: "inbox__item_action_form" %>
                <% end %>

                <%= button_to "Archive",
                  archive_saved_item_path(item),
                  method: :patch,
                  class: "inbox__item_action inbox__item_action--subtle",
                  form_class: "inbox__item_action_form",
                  title: "Archive keeps the item but removes it from your inbox" %>
              </div>

            </div>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="inbox__empty">No saved items yet.</p>
    <% end %>
  </div>
</div>
