<div class="inbox">
  <div class="inbox__card">

    <%= form_with url: saved_items_path,
      scope: :saved_item,
      class: "inbox__form",
      data: { controller: "clear-url-field" } do |form| %>

      <%= form.url_field :url,
        required: true,
        autofocus: true,
        placeholder: "https://example.com/article",
        class: "inbox__input",
        autocomplete: "off",
        autocapitalize: "none",
        spellcheck: false,
        data: { "clear-url-field-target": "input" } %>

      <%= form.submit "Save", class: "inbox__button" %>
    <% end %>


    <% if @saved_items.present? %>
      <ul class="inbox__list" aria-label="Saved items">
        <% @saved_items.each do |item| %>
          <li class="inbox__item">
            <p class="inbox__item_title">
              <a class="inbox__item_link"
                 href="<%= open_saved_item_path(item) %>"
                 target="_blank"
                 rel="noopener noreferrer">
                <%= item.fetched_title.presence || clean_url_for(item) %>
              </a>
            </p>

            <div class="inbox__item_meta">
              <span class="inbox__item_state inbox__item_state--<%= item.state %>">
                <%= item.state.capitalize %>
              </span>

              <% if metadata_unavailable?(item) %>
                <span class="inbox__item_note">Metadata was not available</span>
              <% end %>

              <div class="inbox__item_actions">
                <% unless item.read? %>
                  <%= button_to "Set read",
                    state_saved_item_path(item),
                    method: :patch,
                    params: { saved_item: { state: "read" } },
                    class: "inbox__item_action",
                    form_class: "inbox__item_action_form" %>
                <% end %>

                <%= button_to "Archive",
                  archive_saved_item_path(item),
                  method: :patch,
                  class: "inbox__item_action inbox__item_action--subtle",
                  form_class: "inbox__item_action_form",
                  title: "Archive keeps the item but removes it from your inbox" %>
              </div>
            </div>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="inbox__empty">No saved items yet.</p>
    <% end %>

  </div>
</div>
