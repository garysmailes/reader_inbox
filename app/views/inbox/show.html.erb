<div class="inbox">
  <div class="inbox__card">
    <h1 class="inbox__title">Reading Inbox</h1>
    <p class="inbox__hint">Paste a link now. Read it later.</p>

    <% if flash[:alert].present? %>
      <div class="inbox__alert"><%= flash[:alert] %></div>
    <% end %>

    <% if flash[:notice].present? %>
      <div class="inbox__notice">
        <%= flash[:notice] %>

        <% if flash[:notice] == "Already saved." && params[:saved_item_id].present? %>
          <%= link_to "View", saved_item_path(params[:saved_item_id]) %>
        <% end %>
      </div>
    <% end %>

    <%= form_with url: saved_items_path, scope: :saved_item, class: "inbox__form" do |form| %>
      <%= form.url_field :url,
        required: true,
        autofocus: true,
        placeholder: "https://example.com/article",
        class: "inbox__input" %>

      <%= form.submit "Save", class: "inbox__button" %>
    <% end %>

    <% if @saved_items.present? %>
      <ul class="inbox__list" aria-label="Saved items">
        <% @saved_items.each do |item| %>
          <% clean_url = item.url.to_s.strip.sub(/\Ahttps?:\/\//, "").sub(/\Awww\./, "") %>

          <li class="inbox__item">
            <% if item.fetched_title.present? %>
              <p class="inbox__item_title">
                <a class="inbox__item_link" href="<%= item.url %>" target="_blank" rel="noopener noreferrer">
                  <%= item.fetched_title %>
                </a>
              </p>

              <div class="inbox__item_meta">
                <% if item.domain.present? %>
                  <span class="inbox__item_domain"><%= item.domain %></span>
                <% else %>
                  <span class="inbox__item_domain"><%= clean_url %></span>
                  <span class="inbox__item_note">Metadata unavailable</span>
                <% end %>
              </div>
            <% else %>
              <p class="inbox__item_title">
                <a class="inbox__item_link" href="<%= item.url %>" target="_blank" rel="noopener noreferrer">
                  <%= clean_url %>
                </a>
              </p>

              <div class="inbox__item_meta">
                <span class="inbox__item_note">Metadata unavailable</span>
              </div>
            <% end %>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="inbox__empty">No saved items yet.</p>
    <% end %>
  </div>
</div>
