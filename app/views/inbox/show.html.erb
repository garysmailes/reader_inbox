<div class="inbox">
  <div class="inbox__card">
    <h1 class="inbox__title">Reading Inbox</h1>
    <p class="inbox__hint">Paste a link now. Read it later.</p>

    <% if flash[:alert].present? %>
      <div class="inbox__alert"><%= flash[:alert] %></div>
    <% end %>

    <% if flash[:notice].present? %>
      <div class="inbox__notice">
        <%= flash[:notice] %>

        <% if flash[:notice] == "Already saved." && params[:saved_item_id].present? %>
          <%= link_to "View", saved_item_path(params[:saved_item_id]) %>
        <% end %>
      </div>
    <% end %>

    <%= form_with url: saved_items_path, scope: :saved_item, class: "inbox__form" do |form| %>
      <%= form.url_field :url,
        required: true,
        autofocus: true,
        placeholder: "https://example.com/article",
        class: "inbox__input" %>

      <%= form.submit "Save", class: "inbox__button" %>
    <% end %>

    <% if @saved_items.present? %>
      <ul class="inbox__list" aria-label="Saved items">
        <% @saved_items.each do |item| %>
          <li class="inbox__item">
            <p class="inbox__item_title">
              <a class="inbox__item_link"
                 href="<%= item.url %>"
                 target="_blank"
                 rel="noopener noreferrer">
                <%= item.fetched_title.presence || clean_url_for(item) %>
              </a>
            </p>

            <div class="inbox__item_meta">
              <% if item.domain.present? %>
                <span class="inbox__item_domain"><%= item.domain %></span>
              <% end %>

              <% if metadata_unavailable?(item) %>
                <span class="inbox__item_note">Metadata unavailable</span>
              <% end %>
            </div>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="inbox__empty">No saved items yet.</p>
    <% end %>
  </div>
</div>
